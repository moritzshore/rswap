# columns of NSE value per depth
fig1 <-
fig1 %>% add_trace(
data = stat_df,
color = ~ var,
colors = palette(num_colors),
x = ~ run,
y = ~ stat_df[2],
name = ~ var,
type = 'bar'
)
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df[2],,
name = "mean",
mode = "lines+markers",
type = "scatter"
)
stat_df
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df[2],
name = "mean",
mode = "lines+markers",
type = "scatter"
)
# layout settings
fig1 %>% layout(
title = paste("Statistics for", var),
plot_bgcolor = '#e5ecf6',
autosize = T,
yaxis = list(
title = stat,
zerolinecolor = '#ffff',
zerolinewidth = 2,
gridcolor = 'ffff'
)
) %>%
# remove the colorbar legend
hide_colorbar() %>%
# print out the finsihed plot
print()
if (graph == "default") {
fig1 <- plot_ly()
# dont need columns if not depthwise
if(depth %>% is.null() == FALSE){
num_colors = stat_df$var %>% unique() %>% length()
# columns of NSE value per depth
fig1 <-
fig1 %>% add_trace(
data = stat_df,
color = ~ var,
colors = palette(num_colors),
x = ~ run,
y = ~ stat_df[2],
name = ~ var,
type = 'bar'
)
}
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df[2],
name = "mean",
mode = "lines+markers",
type = "scatter"
)
# layout settings
fig1 %>% layout(
title = paste("Statistics for", var),
plot_bgcolor = '#e5ecf6',
autosize = T,
yaxis = list(
title = stat,
zerolinecolor = '#ffff',
zerolinewidth = 2,
gridcolor = 'ffff'
)
) %>%
# remove the colorbar legend
hide_colorbar() %>%
# print out the finsihed plot
print()
}
# layout settings
fig1 %>% layout(
title = paste("Statistics for", var),
plot_bgcolor = '#e5ecf6',
autosize = T,
yaxis = list(
title = stat,
zerolinecolor = '#ffff',
zerolinewidth = 2,
gridcolor = 'ffff'
)
) %>%
# remove the colorbar legend
hide_colorbar() %>%
# print out the finsihed plot
print()
num_colors
stat_df[2]
if (graph == "default") {
fig1 <- plot_ly()
# dont need columns if not depthwise
if(depth %>% is.null() == FALSE){
num_colors = stat_df$var %>% unique() %>% length()
# columns of NSE value per depth
fig1 <-
fig1 %>% add_trace(
data = stat_df,
color = ~ var,
colors = palette(num_colors),
x = ~ run,
y = ~ stat_df[2],
name = ~ var,
type = 'col'
)
}
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df[2],
name = "mean",
mode = "lines+markers",
type = "scatter"
)
# layout settings
fig1 %>% layout(
title = paste("Statistics for", var),
plot_bgcolor = '#e5ecf6',
autosize = T,
yaxis = list(
title = stat,
zerolinecolor = '#ffff',
zerolinewidth = 2,
gridcolor = 'ffff'
)
) %>%
# remove the colorbar legend
hide_colorbar() %>%
# print out the finsihed plot
print()
}
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df[2],
name = "mean",
mode = "lines+markers",
type = "scatter"
)
# layout settings
fig1 %>% layout(
title = paste("Statistics for", var),
plot_bgcolor = '#e5ecf6',
autosize = T,
yaxis = list(
title = stat,
zerolinecolor = '#ffff',
zerolinewidth = 2,
gridcolor = 'ffff'
)
) %>%
# remove the colorbar legend
hide_colorbar() %>%
# print out the finsihed plot
print()
# columns of NSE value per depth
fig1 <-
fig1 %>% add_trace(
data = stat_df,
color = ~ var,
colors = palette(num_colors),
x = ~ run,
y = ~ stat_df[2],
name = ~ var,
type = 'bar'
)
if (graph == "default") {
fig1 <- plot_ly()
# dont need columns if not depthwise
if(depth %>% is.null() == FALSE){
num_colors = stat_df$var %>% unique() %>% length()
# columns of NSE value per depth
fig1 <-
fig1 %>% add_trace(
data = stat_df,
color = ~ var,
colors = palette(num_colors),
x = ~ run,
y = ~ stat_df[2],
name = ~ var,
type = 'bar'
)
}
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df[2],
name = "mean",
mode = "lines+markers",
type = "scatter"
)
# layout settings
fig1 %>% layout(
title = paste("Statistics for", var),
plot_bgcolor = '#e5ecf6',
autosize = T,
yaxis = list(
title = stat,
zerolinecolor = '#ffff',
zerolinewidth = 2,
gridcolor = 'ffff'
)
) %>%
# remove the colorbar legend
hide_colorbar() %>%
# print out the finsihed plot
print()
}
# extract the run name from the data package
current_run <- project_path %>% str_split("./") %>% unlist() %>% tail(1)
# TODO switch this so a function, or at least a global variable?
if (custom_save_path %>% is.null()) {
custom_save_path <- glue("{project_path}/rswap_saved/")
}
# TODO switch this so a function, or at least a global variable?
if (observed_file_path %>% is.null()) {
observed_file_path <- glue("{project_path}/rswap_observed_data.xlsx")
}
files = list.files(path = custom_save_path, full.names = T)
stat_df <- data.frame()
for (file in files) {
# extract the run name from the data package
run_name <- file %>% str_split("./") %>% unlist() %>% tail(1)
mod = read_swap_output(file, custom_path = T)
mod_filt <- filter_swap_data(mod$custom_depth, var = var, depth = depth)
if(length(stat)>1){stop("rswap ERROR: please pass only one stat value")}
performance = get_performance(
project_path = file,
stat = stat,
variable = var,
depth = depth,
observed_file_path = observed_file_path,
verbose = verbose,
custom_path = T
)
mean_perf <- performance[2] %>% pull() %>% mean() %>% round(4)
performance$run = run_name
performance$mean = mean_perf
stat_df <- rbind(stat_df, performance)
}
# get a path list of all the previous runs
# get the file infos to sort by creation date
details = files %>% file.info()
# color palette
palette <- colorRampPalette(c("dodgerblue4","dodgerblue2","deepskyblue"))
# sort the runs by user stat
if(stat == "NSE"){
best_perf = stat_df$mean %>% max() %>% min()
best_run = stat_df$run[which(stat_df$mean==best_perf) %>% min()]
}else{
stop("stats other than NSE not supported YET")
}
if (graph == "default") {
fig1 <- plot_ly()
# dont need columns if not depthwise
if(depth %>% is.null() == FALSE){
num_colors = stat_df$var %>% unique() %>% length()
# columns of NSE value per depth
fig1 <-
fig1 %>% add_trace(
data = stat_df,
color = ~ var,
colors = palette(num_colors),
x = ~ run,
y = ~ stat_df[2],
name = ~ var,
type = 'bar'
)
}
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df[2],
name = "mean",
mode = "lines+markers",
type = "scatter"
)
# layout settings
fig1 %>% layout(
title = paste("Statistics for", var),
plot_bgcolor = '#e5ecf6',
autosize = T,
yaxis = list(
title = stat,
zerolinecolor = '#ffff',
zerolinewidth = 2,
gridcolor = 'ffff'
)
) %>%
# remove the colorbar legend
hide_colorbar() %>%
# print out the finsihed plot
print()
}
if (graph == "default") {
fig1 <- plot_ly()
# dont need columns if not depthwise
if(depth %>% is.null() == FALSE){
num_colors = stat_df$var %>% unique() %>% length()
# columns of NSE value per depth
fig1 <-
fig1 %>% add_trace(
data = stat_df,
color = ~ var,
colors = palette(num_colors),
x = ~ run,
y = ~ stat_df[2],
name = ~ var,
type = 'bar'
)
}
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df[2],
name = "mean",
mode = "lines+markers",
type = "scatter"
)
# layout settings
fig1 %>% layout(
title = paste("Statistics for", var),
plot_bgcolor = '#e5ecf6',
autosize = T,
yaxis = list(
title = stat,
zerolinecolor = '#ffff',
zerolinewidth = 2,
gridcolor = 'ffff'
)
) %>%
# remove the colorbar legend
hide_colorbar() %>%
# print out the finsihed plot
print()
}
if (graph == "default") {
fig1 <- plot_ly()
# dont need columns if not depthwise
if(depth %>% is.null() == FALSE){
num_colors = stat_df$var %>% unique() %>% length()
# columns of NSE value per depth
fig1 <-
fig1 %>% add_trace(
data = stat_df,
color = ~ var,
colors = palette(num_colors),
x = ~ run,
y = ~ stat_df[2],
name = ~ var,
type = 'bar'
)
}
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df[2],
name = "mean",
mode = "lines+markers",
type = "scatter"
)
# layout settings
fig1 %>% layout(
title = paste("Statistics for", var),
plot_bgcolor = '#e5ecf6',
autosize = T,
yaxis = list(
title = stat,
zerolinecolor = '#ffff',
zerolinewidth = 2,
gridcolor = 'ffff'
)
) %>%
# remove the colorbar legend
hide_colorbar() %>%
# print out the finsihed plot
print()
}
stat_df
stat_df[2]
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df[2] %>% pull(),
name = "mean",
mode = "lines+markers",
type = "scatter"
)
if (graph == "default") {
fig1 <- plot_ly()
# dont need columns if not depthwise
if(depth %>% is.null() == FALSE){
num_colors = stat_df$var %>% unique() %>% length()
# columns of NSE value per depth
fig1 <-
fig1 %>% add_trace(
data = stat_df,
color = ~ var,
colors = palette(num_colors),
x = ~ run,
y = ~ stat_df[2] %>% pull(),
name = ~ var,
type = 'bar'
)
}
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df[2] %>% pull(),
name = "mean",
mode = "lines+markers",
type = "scatter"
)
# layout settings
fig1 %>% layout(
title = paste("Statistics for", var),
plot_bgcolor = '#e5ecf6',
autosize = T,
yaxis = list(
title = stat,
zerolinecolor = '#ffff',
zerolinewidth = 2,
gridcolor = 'ffff'
)
) %>%
# remove the colorbar legend
hide_colorbar() %>%
# print out the finsihed plot
print()
}
stat_df
if (graph == "default") {
fig1 <- plot_ly()
# dont need columns if not depthwise
if(depth %>% is.null() == FALSE){
num_colors = stat_df$var %>% unique() %>% length()
# columns of NSE value per depth
fig1 <-
fig1 %>% add_trace(
data = stat_df,
color = ~ var,
colors = palette(num_colors),
x = ~ run,
y = ~ stat_df[2] %>% pull(),
name = ~ var,
type = 'bar'
)
}
# mean of columns as a line
fig1 <-
fig1 %>% add_trace(
data = stat_df,
x = ~ run,
y = ~  stat_df$mean,
name = "mean",
mode = "lines+markers",
type = "scatter"
)
# layout settings
fig1 %>% layout(
title = paste("Statistics for", var),
plot_bgcolor = '#e5ecf6',
autosize = T,
yaxis = list(
title = stat,
zerolinecolor = '#ffff',
zerolinewidth = 2,
gridcolor = 'ffff'
)
) %>%
# remove the colorbar legend
hide_colorbar() %>%
# print out the finsihed plot
print()
}
